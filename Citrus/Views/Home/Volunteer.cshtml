
@{
    ViewBag.Title = "Volunteer";
    Layout = "~/Views/Shared/_LayoutMaterial.cshtml";
}

@section styles{
    <style type="text/css">
        .tab-content {
            white-space: normal;
        }

        .tabLink {
            font-size: 16px;
        }

        #map_subscribed, #map_nearby {
            width: 95%;
            height: 300px;
        }
    </style>

}
<section id="main">

    <section id="content">
        <div class="container" data-ng-controller="mainController as main">

            <div class="block-header">
                <h1>{{main.volunteer.Name}}</h1>

                <ul class="actions m-t-20 hidden-xs">
                    <li class="dropdown">
                        <a href="" data-toggle="dropdown">
                            <i class="zmdi zmdi-more-vert"></i>
                        </a>

                        <ul class="dropdown-menu dropdown-menu-right">
                            <li>
                                <a href="">Privacy Settings</a>
                            </li>
                            <li>
                                <a href="">Account Settings</a>
                            </li>
                            <li>
                                <a href="">Other Settings</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="card" id="profile-main">
                <div class="pm-overview c-overflow">
                    <div class="pmo-pic">
                        <div class="p-relative">
                            <a href="">
                                <img class="img-responsive" src="~/img/profile-pics/2.jpg" alt="">
                            </a>


                        </div>



                    </div>

                    <div class="pmo-block pmo-contact hidden-xs">

                        <ul>
                            <li><i class="zmdi zmdi-email"></i> {{main.volunteer.Email}}</li>
                            <li><i class="zmdi zmdi-pin"></i> {{main.volunteer.Address}}</li>
                        </ul>
                    </div>

                    <div class="pmo-block pmo-items hidden-xs">
                        <h2>About Me</h2>

                        <div class="pmob-body">
                            <div class="row">
                                {{main.volunteer.Description}}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pm-body clearfix">



                    <uib-tabset class="tab-nav">
                        <uib-tab>
                            <uib-tab-heading class="waves-effect">
                                <span class="tabLink">Events I'm Attending</span>
                            </uib-tab-heading>
                            <div class="pmb-block p-t-0">

                                <div id="map_subscribed"></div>

                                <div class="row" ng-repeat="event in main.subscribedEvents">
                                    <div class="col-md-7">
                                        <h3>{{event.Name}}</h3>
                                        <h4>{{event.Organization}}</h4>
                                        <p>{{event.Address}}</p>
                                        <p>{{event.Description}}</p>
                                    </div>
                                    <div class="col-md-5">
                                        <img ng-src="https://maps.googleapis.com/maps/api/staticmap?markers={{event.Address}}&zoom=15&size=300x200&maptype=roadmap&scale=2"
                                             class="img-responsive m-t-20" />
                                    </div>



                                    <hr />
                                </div>
                            </div>
                        </uib-tab>

                        <uib-tab>
                            <uib-tab-heading class="waves-effect">
                                <span class="tabLink">Events Near Me</span>
                            </uib-tab-heading>
                            <div class="pmb-block p-t-0">

                                @*<div id="map_nearby"></div>*@

                                <div class="row" ng-repeat="event in main.nearbyEvents">
                                    <div class="col-md-7">
                                        <h3>{{event.Name}}</h3>
                                        <h4>{{event.Organization}}</h4>
                                        <p>{{event.Address}}</p>
                                        <p>{{event.Description}}</p>
                                    </div>
                                    <div class="col-md-5">
                                        <img ng-src="https://maps.googleapis.com/maps/api/staticmap?markers={{event.Address}}&zoom=15&size=300x200&maptype=roadmap&scale=2"
                                             class="img-responsive m-t-20" />
                                    </div>



                                    <hr />
                                </div>
                            </div>
                        </uib-tab>

                    </uib-tabset>








                </div>
            </div>
        </div>
    </section>
</section>

@section scripts {

    <script src="~/Scripts/google.maps.js"></script>

    <script type="text/javascript">

            citrus.services.factory = function ($baseService) {
            var aServiceObject = citrus.services;
            var newService = $baseService.merge(true, {}, aServiceObject, $baseService);
            return newService;
        }

        citrus.page.mainControllerFactory = function ($scope, $baseController, $citrusService) {
            var vm = this;

            $baseController.merge(vm, $baseController);

            vm.$scope = $scope;
            vm.citrusService = $citrusService;
            vm.notify = vm.citrusService.getNotifier($scope);
            vm.subscribedEvents = [];
            vm.nearbyEvents = [];
            vm.volunteer = {};

            vm.getVolunteerSuccess = _getVolunteerSuccess;
            vm.getSubscribedSuccess = _getSubscribedSuccess;
            vm.getNearbySuccess = _getNearbySuccess;
            vm.ajaxError = _ajaxError;

            render();

            function render() {

                vm.citrusService.getVolunteerById(1, vm.getVolunteerSuccess, vm.ajaxError);
                vm.citrusService.getSubscribedEvents(1, vm.getSubscribedSuccess, vm.ajaxError);
                vm.citrusService.getNearbyEvents(1, vm.getNearbySuccess, vm.ajaxError);
            }

            function _getVolunteerSuccess(data) {
                console.log(data);
                vm.notify(function () {
                    vm.volunteer = data.Item;
                });
            }

            function _getSubscribedSuccess(data) {
                console.log(data);
                vm.notify(function () {
                    vm.subscribedEvents = data.Items;
                });


                var map;
                var elevator;
                var myOptions = {
                    zoom: 10,
                    center: new google.maps.LatLng(34.058755, -118.393105),
                    mapTypeId: 'roadmap'
                };
                map = new google.maps.Map($('#map_subscribed')[0], myOptions);

                var addresses = [];

                for (var x = 0; x < vm.subscribedEvents.length; x++) {
                    addresses.push(vm.subscribedEvents[x].Address);
                }

                for (var x = 0; x < addresses.length; x++) {
                    $.getJSON('http://maps.googleapis.com/maps/api/geocode/json?address=' + addresses[x] + '&sensor=false', null, function (data) {
                        var p = data.results[0].geometry.location
                        var latlng = new google.maps.LatLng(p.lat, p.lng);
                        new google.maps.Marker({
                            position: latlng,
                            map: map
                        });

                    });
                }



            }

            function _getNearbySuccess(data) {
                console.log(data);
                vm.notify(function () {
                    vm.nearbyEvents = data.Items;
                });

                //var map;
                //var elevator;
                //var myOptions = {
                //    zoom: 10,
                //    center: new google.maps.LatLng(34.079516, -118.417480),
                //    mapTypeId: 'roadmap'
                //};
                //map = new google.maps.Map($('#map_nearby')[0], myOptions);

                //var addresses = [];

                //for (var x = 0; x < vm.nearbyEvents.length; x++) {
                //    addresses.push(vm.nearbyEvents[x].Address);
                //}

                //for (var x = 0; x < addresses.length; x++) {
                //    $.getJSON('http://maps.googleapis.com/maps/api/geocode/json?address=' + addresses[x] + '&sensor=false', null, function (data) {
                //        var p = data.results[0].geometry.location
                //        var latlng = new google.maps.LatLng(p.lat, p.lng);
                //        new google.maps.Marker({
                //            position: latlng,
                //            map: map
                //        });

                //    });
                //}

            }

            function _ajaxError(error) {
                console.log("ajax error: ", error);
            }





           


        }

        citrus.ng.addService(citrus.ng.app.module
            , "$citrusService"
            , ["$baseService"]
            , citrus.services.factory);

        citrus.ng.addController(citrus.ng.app.module
            , "mainController"
            , ['$scope', '$baseController', '$citrusService']
            , citrus.page.mainControllerFactory);


        



    </script>

}